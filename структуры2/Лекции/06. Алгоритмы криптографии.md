**Криптология  = криптография + криптоанализ**  
**Криптография** - наука о методах обеспечения конфиденциальности и аутентичности информации  
**Криптоанализ** - наука о методах расшифровки зашифрованной информации без предназначенного для расшифровки ключа  
**Ключ** - секретный блок данных, используемый криптографическим алгоритмом при шифровании, дешифровании, постановке и проверке цифровой подписи, вычислении кода аутентификации
## Примеры шифров
#### Шифр Цезаря
![[06_01. Шифр Цезаря.png]]  
**Ключ:** 3  
**Открытый текст:**  
P = HELLO CAESAR CIPHER  
**Зашифрованный текст:**  
C = KHOOR FDHVDU FLSKHU
#### Квадрат Полибия
|     | 1   | 2   | 3   | 4   | 5   |
| --- | --- | --- | --- | --- | --- |
| 1   | A   | B   | C   | D   | E   |
| 2   | F   | G   | H   | I/J | K   |
| 3   | L   | M   | N   | O   | P   |
| 4   | Q   | R   | S   | T   | U   |
| 5   | V   | W   | X   | Y   | Z   |
#### Решетка Кардано
![[06_02. Решетка Кардано.png]]  
**Зашифрованный текст:** ищите под ковром
#### Таблица Виженера
![[06_03. Таблица Виженера.png]]  

| Открытый текст     | h   | e   | l   | l   | o   | w   | o   | r   | l   | d   |
| ------------------ | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Ключ               | a   | n   | y   | a   | a   | n   | y   | a   | a   | n   |
| Зашифрованый текст | h   | r   | i   | l   | o   | j   | m   | r   | l   | q   |
#### Шифр Вернама
![[06_04. Схема телетайпа.png]]  
## Классификация криптоалгоритмов
1. По способу шифрования:
	- **Тайнопись** - скрывается сам алгоритм, по которому прячутся данные. Если злоумышленник узнает алгоритм, информация будет раскрыта
	- **Шифрование с ключом**: текст, который подлежит шифрованию, называется **открытым текстом**, зашифрованный - **шифртекст**. Между открытым текстом и шифртекстом находится алгоритм, результат работы которого зависит от ключа шифрования. На сегодняшний день надежным считается ключ 256 бит и более. 
2. По способу использования ключа:
	- **Симметричный криптоалгоритм** - для шифрования и дешифрования используется один и тот же ключ
	- **Ассиметричный криптоалгоритм** - шифрование производится открытым ключом, известным всем желающим; дешифрование - закрытым ключом, известным только получателю
3. По воздействию на шифруемые данные:
	- **Перестановочные шифры** - алгоритм лишь переставляет биты исходного текста по некоторому правилу
	- **Подстановочные шифры** - сам блок, подлежащий шифрованию, меняется по законам криптоалгоритма
4. По размеру шифруемого блока:
	- **Поточные шифры** - отдельно шифруется каждый бит исходного текста
	- **Блочные шифры** - шифруется сразу целый блок бит (16, 32, 64, 128, ...), результаты шифрования зависят от всех бит шифруемого блока. 
  
Наиболее надежные на сегодняшний день шифры - **симметричные**, **блочные**, **подстановочные**. 
#### Симметричные поточные шифры (шифры гаммирования)
![[06_05. Шифр гаммирования.png]]  
**Плюсы:**
- Простота шифрования
- Невозможность расшифровать открытый текст, не зная гаммы, если длина гаммы больше либо равна длине открытого текста
  
**Минусы:**
- Если злоумышленнику известна часть открытого текста и соответствующий зашифрованный, находится часть гамма-последовательности
#### Симметричные блочные шифры
Для обозначения будем использовать следующие операции преобразования криптоалгоритмов:  
![[06_06. Операции преобразования криптоалгоритмов.png]]  
Во всех формулах под параметром $V$ обычно понимают:
1. Некоторую константу
2. Часть шифруемого блока
3. Материал ключа
  
$key$ = 11010101011101001110100001011011010101101010011010011  

| 0    | 1    | 2   | ... | 15  |
| ---- | ---- | --- | --- | --- |
| 1101 | 0101 | ... | ... | ... |
## Сеть Фейштеля
![[06_07. Сеть Фейштеля.png]]  
**Сеть Фейштеля** является классической схемой симметричного шифрования. Исходный блок делится на 2 части $X1$ и $X2$. К части $X1$ применяется образующая функция $F$, результат с помощью операции $xor$ накладывается на часть $x2$ и ветви меняются местами. 
Подобные действия называются **раундом сети**. Обычно количество раундов - 8-32. В конце алгоритма ветви просто меняются местами. Параметры $V1$, $V2$, ..., $Vr$ обычно являются материалами ключа. Криптостойкость сети нелинейно возрастает с увеличением числа раундов. Размер блока, как правило, от 64 до 256 бит. Поскольку наложение одной ветви на другую производится с помощью операции $xor$, а она обратима при повторном использовании, то ту же самую сеть можно использовать для дешифрования, лишь изменив порядок параметров $Vi$ на обратный. 
```cpp
#include <iostream>
using namespace std;

int f(int x1, int v) {
    return x1 + v;
}

void encrypt(int x1, int x2, int* key, int n, int& z1, int& z2) {
    for (int i = 1; i < n; i++) {
        x2 = x2 ^ f(x1, key[i]);
        swap(x1, x2);
    }
    z1 = x2;
    z2 = x1;
}

void decrypt(int x1, int x2, int* key, int n, int& z1, int& z2) {
    for (int i = n - 1; i >= 0; i--) {
        x2 = x2 ^ f(x1, key[i]);
        swap(x1, x2);
    }
    z1 = x2;
    z2 = x1;
}

void main() {
    int x1 = 2000000000, x2 = 1, z1 = 0, z2 = 0;
    int key[8] = { 111, 222, 333, 444, 555, 666, 777, 888 };
    encrypt(x1, x2, key, 8, z1, z2);
    cout << z1 << ' ' << z2 << endl;
    int y1 = 0, y2 = 0;
    decrypt(z1, z2, key, 8, y1, y2);
    cout << y1 << ' ' << y2 << endl;
    system("pause");
}
```
![[06_08. Сеть Фейштеля с 4 ветвями.png]]  
## Алгоритм DES - Data Encription Standart
В 1977 году был предложен, а в 1980 принят как стандарт симметричного шифрования США алгоритм **DES**. Сам алгоритм представляет классическую сеть Фейштеля из 16 раундов с единственным добавлением так называемого начального и конечного **"забеливания"** - перемешивания бит исходного блока перед началом работы сети и конечного блока после работы сети. Размер шифруемого блока - 64 бита, размер ключа - 56 бит, образующая функция выглядит так:  
![[06_09. Образующая функция алгоритма DES.png]]  
#### Алгоритм 3DES
$DES(k3; DES(k2; DES(k1; M)))$
Существует 3 типа алгоритма 3DES:
- **DES-EEE3** - шифруется 3 раза с 3 разными ключами (операции шифрование-шифрование-шифрование)
- **DES-EDE3** - 3DES операции шифровка-расшифровка-шифровка с 3 разными ключами
- **DES-EEE2** и **DES-EDE2** - как и предыдущие, за исключением того, что на 1 и 3 шаге используется одинаковый ключ
  
Самая популярная разновидность 3DES - это **DES-EDE3**
## Алгоритм ГОСТ 28147-89
![[06_10. Алгоритм ГОСТ 28147-89.png]]  
## Конкурс AES
#### Алгоритм MARS
![[06_11. Алгоритм MARS.png]]  
#### Алгоритм Rijndael
![[06_12. Алгоритм Rijndael.png]]
## Ассиметричные криптоалгоритмы
У **симметричных криптоалгоритмов** существует 2 недостатка:
1. В системе из $n$ пользователей необходимо распространить $\frac{n(n-1)}{2}$ ключей
2. Злоумышленник, вскрыв криптосистему пользователя $A$, получает доступ ко всем его ключам и от его имени может посылать сообщение
  
Одним из способов решения данных проблем является **ассиметричная криптография**. Суть ее заключается в том, что процессы шифрования и дешифрования производятся разными ключами. Шифрование ведется так называемым "открытым" ключом, известным всем желающим. Дешифрование производится "закрытым" ключом, известным только получателю. При этом закрытый ключ никак нельзя получить, кроме как полным перебором, имея исходный текст, зашифрованный и открытый ключ. В системе из $n$ пользователей такая схема потребует $2n$ ключей.  
1 схема ассиметричного шифрования носит название **RSA**:
1. Выбирается 2 очень больших простых числа $p$, $q$
2. Находится их произведение $n = p * q$
3. Выбирается произвольное число $e < n$, взаимно простое с $p-1$, $q-1$ ($НОД(e, p-1, q-1)$)
4. Методом Эйлера или некоторым другим решается уравнение: $(d*e)$ % $(p-1)(q-1) = 1$. Таких чисел $d$ бесконечно много. Выбирается одно из них. Пара $(e, n)$ публикуется как открытый ключ. Число $d$ - закрытый ключ. 
  

Процессы шифрования-дешифрования выглядят очень просто: все исходное сообщение разбивается на блоки длиной $k = [log_2n]$. Каждый такой блок - это некоторое целое число $a$ из отрезка $[0; 2^k-1]$. Над каждым этим числом проводятся операции $b_i=(a_i^e)$ % $n$. Последовательность $b_i$ и есть зашифрованный код. Расшифровка производится аналогично: $a_i = (b_i^d)$ % $n$.  
```python
for d in range(1000):
	if 5 * d % 288 == 1:
	print(d)
```
#### Цифровая подпись
Ассиметричная криптография также дает симпатичное решение цифровой подписи документов.  
**Цифровая подпись** - это некоторый идентификатор, который подтверждает целостность пришедшего документа, а также его авторство.  
Будем находить от открытого текста хэш-значение - число, имеющее определенный размер и уникально определяющее открытый текст. При этом данные значения должны отвечать как минимум 2 требованиям:
1. Размер хэша в битах для любого текста должен быть один и тот же.
2. При изменении исходного текста на 1 бит идеальный хэш инвертирует половину произвольных бит
  
Стандартный размер хэша - 64, 128, 256, ... бит. Теоретически можно подобрать текст с тем же самым хэшем, что и у шифруемого текста. Но это придется делать полным перебором и полученный текст вряд ли будет осмысленным. Полученный хэш отправитель зашифровывает своим закрытым ключом. Получатель расшифровывает полученный хэш открытым ключом и сравнивает полученное значение, повторно вычисляя хэш от документа.
#### Сжимающая хэш-функция
![[06_13. Сжимающая хэш-функция.png]]
#### Хэш-функция на блочных шифрах
![[06_14. Хэш-функция на блочных шифрах.png]]